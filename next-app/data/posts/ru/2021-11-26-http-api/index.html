<p>В двух словах: Под API, обычно, подразумевают способ, с помощью которого программы или сервисы могут запрашивать данные у других сервисов.</p>

<h2 id="пример-twitter-api">Пример Twitter API</h2>

<p>Пример. У твиттера есть сайт, на котором мы можем просматривать твиты. Кликая по ссылкам мы попадаем на разные адреса, по которым доступна разная информация: лента твитов, страница твита, личный кабинет, сброс пароля, рекламный кабинет и так далее.</p>

<ul>
  <li>https://twitter.com/mokevnin – страница конкретного пользователя</li>
  <li>https://twitter.com/mokevnin/status/1446464250499710976 – страница конкретного твита</li>
</ul>

<p>Каждая из этих страниц возвращает HTML, в котором информация представлена в том виде, в котором мы ее видим, со всеми элементами дизайна. Сайт твиттера адаптирован под небольшие экраны, поэтому открывается с любого устройства где есть браузер. Но кроме сайта у твиттера есть и мобильное приложение, которое показывает ту же самую информацию, но с другим, более удобным интерфейсом, адаптированным под конкретный телефон.</p>

<p>Мобильное приложение, в отличии от сайта, физически хранится и запускается прямо на телефоне. И весь внешний вид тоже описывается внутри приложения. Для работы такого приложения нужны чистые данные, которых на телефоне нет, они есть на серверах твиттера. Как загрузить их на телефон? Обычные адрес страниц нам не подходят, так как они возвращают не данные, а готовые html-страницы.</p>

<p>Именно здесь на помощь приходит API. Твиттер предоставляет специальные http-адреса, по которым доступны чистые данные, а не конкретные интернет-страницы с готовым внешним видом. Данные по таким адресам отдаются в структурированном формате, чаще всего JSON. Один сервис “упаковывает” данные в JSON формат, другой, который ходит за данными, “распаковывает” их из JSON и использует внутри себя для отображения. Пример запроса пользователя:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c"># Адрес, по которому возвращается список указанных пользователей</span>
<span class="c"># В данном случае запрашивается один пользователь</span>
https://api.twitter.com/2/users/by?usernames<span class="o">=</span>hexletHQ

<span class="c"># В ответ приходит JSON такой структуры:</span>
<span class="o">{</span>
  <span class="s2">"data"</span>: <span class="o">[</span>
    <span class="o">{</span>
      <span class="s2">"created_at"</span>: <span class="s2">"2013-12-14T04:35:55.000Z"</span>,
      <span class="s2">"id"</span>: <span class="s2">"2244994945"</span>,
      <span class="s2">"name"</span>: <span class="s2">"HexletHQ"</span>,
      <span class="s2">"description"</span>: <span class="s2">"Хекслет - курсы программирования"</span>,
      <span class="s2">"pinned_tweet_id"</span>: <span class="s2">"1464165859761573893"</span>,
      <span class="s2">"username"</span>: <span class="s2">"hexlethq"</span>
    <span class="o">}</span>,
  <span class="o">]</span>,
<span class="o">}</span>
</code></pre></div></div>

<p>Задача этого API дать удобный доступ к данным твиттера. Причем это API используется как самим твиттером в мобильных приложениях, так и сторонними сервисами, которые управляют твиттером. Например маркетологи используют сервисы, которые автоматически публикуют твиты по расписанию.</p>

<p>Кстати, сам твиттер использует свое API, в том числе для виджетов, которые можно встраивать на любой сайт для отображения конкретного твита или ленты твитов, хороший пример – <a href="https://ru.hexlet.io">главная Хекслета</a>. И, если говорить откровенно, то сам сайт твиттера работает по API. В браузер грузится JS-код, который реализует логику вывода и ходит за данными на сервер (по API).</p>

<p>У твиттера есть <a href="https://developer.twitter.com/en/docs/twitter-api">специальный сайт</a> для разработчиков, на котором подробно описано их API, адреса, параметры, которые можно передавать и форматы ответов. Подобное описание есть у любого сервиса с публичным API, то есть доступным для использования в интернете. Правда публичное не означает бесплатное, API может быть и часто бывает платным.</p>

<p><img src="/assets/twitter-api.png" alt="Twitter API" /></p>

<h2 id="http-api">HTTP API</h2>

<p>Twitter API – это пример HTTP API, оно работает по протоколу HTTP, через который браузеры загружают и показывают сайты. HTTP наиболее распространенный и удобный способ делать API для публичных интернет-сервисов. На него заточен весь интернет, у него хорошая поддержка в любом языке программирования. В конце-концов это простой протокол, который так или иначе знают все веб-программисты.</p>

<p>Но не все HTTP API одинаковые. HTTP оставляет многое на откуп разработчикам, поэтому разные HTTP API могут отличаться друг от друга кардинально, например, форматом данных. Самый популярный формат JSON, но кроме него используется и XML. XML и HTML очень похожи по внешнему виду, но XML описывает данные, а не то как они расположены и выглядят:</p>

<div class="language-xml highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c">&lt;!-- Просто пример API из интернета --&gt;</span>
<span class="nt">&lt;Contents&gt;</span>
    <span class="nt">&lt;Key&gt;</span>europe/france/cannes.jpg<span class="nt">&lt;/Key&gt;</span>
    <span class="nt">&lt;LastModified&gt;</span>2010-02-17T22:11:12.487Z<span class="nt">&lt;/LastModified&gt;</span>
    <span class="nt">&lt;ETag&gt;</span>"53fc311c15eda0a031809982ccf92aac"<span class="nt">&lt;/ETag&gt;</span>
    <span class="nt">&lt;Size&gt;</span>5061631<span class="nt">&lt;/Size&gt;</span>
    <span class="nt">&lt;StorageClass&gt;</span>STANDARD<span class="nt">&lt;/StorageClass&gt;</span>
<span class="nt">&lt;/Contents&gt;</span>
</code></pre></div></div>

<p>Существуют и другие форматы, но их используют значительно реже. В целом, HTTP никак не ограничивает формат, можно придумать и использовать свой собственный.</p>

<p>Кроме форматов, HTTP API отличаются тем как у них структурированы адреса. Например у <a href="https://ru.code-basics.com">code-basics</a> на каждый вид данных есть свой адрес:</p>

<ul>
  <li>https://code-basics.com/api/languages.json – список языков, по которым есть курсы</li>
  <li>https://code-basics.com/api/languages/12.json – информация о курсе</li>
  <li>https://code-basics.com/api/languages/12/lessons.json – список уроков курса по языку</li>
</ul>

<p>Подобное API часто называют REST API. Подробнее о нем в другой статье. Иногда API выглядит так, что адрес всегда один, но на него отправляются разные параметры запроса. У данного способа есть множество разновидностей, например, json-rpc, graphql и другое:</p>

<div class="language-sh highlighter-rouge"><div class="highlight"><pre class="syntax"><code><span class="c"># Все запросы идут только на этот адрес</span>
https://some-site.com/api/rpc
https://some-site.com/api/rpc?param<span class="o">=</span>value
</code></pre></div></div>

<p>Ну и наконец Websocket API, когда взаимодействие идет в режиме реального времени в обе стороны, в отличии от примеров выше, где клиент (тот кто использует API), должен запрашивать данные сам. С помощью Websocket делаются приложения реального времени, например чаты или игры. В этих приложениях данные измененные на сервере, должны максимально быстро уходить всем заинтересованным клиентам.</p>

<h2 id="не-http-api">Не HTTP API</h2>

<p>API бывает не только HTTP. Обычно, такие API встречаются внутри сервиса, для взаимодействия его компонентов, каждый из которых ведет себя как маленький сервис. Такие API могут использовать как другой протокол, например TCP, так и строиться вообще поверх других подходов, например с помощью систем очередей или потоков. Ключевые слова: grpc, rabbitmq, kafka.</p>
